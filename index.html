<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CUPONERA âœ¨</title>
    
    <link rel="stylesheet" href="assets/scss/main.css">
</head>
<body class="index-page">
    <nav class="navbar">
        <div class="dropdown">
            <button onclick="toggleMenu()" class="dropbtn">â˜° MenÃº</button>
            <div id="myDropdown" class="dropdown-content">
                <a href="pages/jump.html">ğŸƒ Snoopy Jump</a>
                <a href="pages/memorygame.html">ğŸ§© Memoria</a>
                <a href="pages/quizgame.html">ğŸ§  Preguntados</a>
                <a href="pages/cooking_v2.html">ğŸ‘¨â€ğŸ³ Food Truck</a>
                <a href="pages/djsnoopy.html">ğŸµ Dj Snoopy</a>
                <a href="pages/codigos.html">ğŸ† Mis CÃ³digos</a>
                <a onclick="resetApp()">ğŸ§¹ Reset Total (Admin)</a>
            </div>
        </div>
    </nav>

    <div class="main-card">
        <img src="assets/images/snoopy.jpg" alt="Snoopy" class="snoopy-header">
        <h1>Hola, mi amor âœ¨</h1>
        <input type="text" id="pass" placeholder="IngresÃ¡ un cÃ³digo secreto">
        <br>
        <button class="btn-validar" id="btn-val" onclick="reveal()">Validar CÃ³digo ğŸ’–</button>
        <p id="counter" class="status-msg"></p>
        <div id="gift-area">
            <div class="envelope" id="env" onclick="generateTicket()">ğŸ’Œ</div>
            <canvas id="couponCanvas"></canvas>
            <center>
                <a id="downloadLink" class="action-btn download-link">â¬‡ï¸ Guardar CupÃ³n</a>
                <button id="btn-restart" class="action-btn btn-restart" onclick="resetUI()">Canjear otro âœ¨</button>
            </center>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        // --- LÃ“GICA DE NEGOCIO (Exclusiva de esta pÃ¡gina) ---
        const CODIGOS = ["culogordo", "ternerito", "05052025", "bebota", "elefante", "cocodrilo", "mariquita", "01022025", "24032025", "woodstuck", "sanvalentin", "papasfritas", "peonias", "hombrearaÃ±a", "patatuilla", "silenciogil", "chipamboca", "colorincolorao", "gatitoexplota", "pinguinoenojado", "uncodigorandom", "uncodigorandom2", "equisde", "esnupi", "ca1000", "hayquematarlo"]; 
        const VALES = ["UNA COMIDA A ELECCIÃ“N", "UN REZO ğŸ™", "UNA HORA DE MIMOS", "PASAR UN DÃA DONDE QUIERAS", "ALGO DULCE", "DORMIR UNA SIESTA", "JIJIS", "UNA COCUCHA O UN JUGO", "NO DECIRTE QUE NO (12 HS)", "REUTILIZAR UN CUPÃ“N USADO", "UNAS MILANGAS NAPOLITANAS DE POLLO", "UNA PIZZA CASERA", "ELEGIR UNA PELÃCULA", "UNA CARTITA", "UN REGALO", "$4000", "UN ASADO", "UN DÃA EN LA PLAYA O EN LA PILETA", "GALLETITAS BLOCK", "UNA HAMBURGUESA", "HELADO", "IR A FOODIE", "CUMPLIR UN DESEO", "FLORES O PELUCHE" ];

        let usados = JSON.parse(localStorage.getItem('cuponesUsados')) || [];
        let canjeados = JSON.parse(localStorage.getItem('codigosCanjeados')) || [];
        let codigoActual = "";

        function actualizarEstado() {
            const restantes = VALES.length - usados.length;
            document.getElementById('counter').textContent = restantes === 0 ? "Todo canjeado â¤ï¸" : `Quedan ${restantes} cupones.`;
        }
        actualizarEstado();

        function reveal() {
            const input = document.getElementById('pass').value.toLowerCase().trim();
            if (!CODIGOS.includes(input)) { alert("CÃ³digo invÃ¡lido"); return; }
            if (canjeados.includes(input)) { alert("Ya usado"); return; }
            codigoActual = input;
            document.getElementById('gift-area').style.display = 'block';
            document.getElementById('btn-val').disabled = true;
        }

        function resetUI() {
            document.getElementById('pass').value = ""; document.getElementById('pass').disabled = false;
            document.getElementById('btn-val').disabled = false; document.getElementById('gift-area').style.display = 'none';
            document.getElementById('env').style.display = 'inline-block'; document.getElementById('couponCanvas').style.display = 'none';
            document.getElementById('downloadLink').style.display = 'none'; document.getElementById('btn-restart').style.display = 'none';
        }

        function generateTicket() {
            const canvas = document.getElementById('couponCanvas'); const ctx = canvas.getContext('2d');
            const link = document.getElementById('downloadLink'); const restartBtn = document.getElementById('btn-restart');
            const disponibles = VALES.filter(v => !usados.includes(v));
            if (disponibles.length === 0) return;
            const miVale = disponibles[Math.floor(Math.random() * disponibles.length)];
            document.getElementById('env').style.display = 'none';
            canvas.width = 800; canvas.height = 450; canvas.style.display = 'block';
            const hoy = new Date(); const expira = new Date(); expira.setDate(hoy.getDate() + 15);
            ctx.fillStyle = "#ffffff"; ctx.fillRect(0, 0, 800, 450);
            ctx.fillStyle = "#fff0f5";
            for(let i=0; i<15; i++) for(let j=0; j<10; j++) { ctx.font = "20px Arial"; ctx.fillText("â™¥", i*60 + 20, j*50 + 30); }
            ctx.strokeStyle = "#fb6f92"; ctx.lineWidth = 14; ctx.strokeRect(30, 30, 740, 390); 
            ctx.strokeStyle = "#ffc8dd"; ctx.lineWidth = 4; ctx.strokeRect(45, 45, 710, 360);
            ctx.setLineDash([10, 10]); ctx.strokeStyle = "#ffc8dd"; ctx.beginPath(); ctx.moveTo(60, 240); ctx.lineTo(740, 240); ctx.stroke(); ctx.setLineDash([]);
            ctx.textAlign = "center"; ctx.fillStyle = "#fb6f92"; ctx.font = "bold 48px Quicksand"; ctx.fillText("CUPÃ“N VÃLIDO POR...", 400, 110);
            ctx.fillStyle = "#8a5a6a"; ctx.font = "bold 34px Quicksand"; ctx.fillText(miVale, 400, 190);
            ctx.font = "bold 20px Quicksand"; ctx.fillStyle = "#ff8fab"; ctx.fillText(`CANJEADO: ${hoy.toLocaleDateString()}`, 400, 290);
            ctx.fillStyle = "#fb6f92"; ctx.fillText(`EXPIRA: ${expira.toLocaleDateString()}`, 400, 335);
            ctx.font = "italic 22px Quicksand"; ctx.fillStyle = "#8a5a6a"; ctx.fillText("De IvÃ¡n, con mucho amor â¤ï¸", 400, 385);
            usados.push(miVale); canjeados.push(codigoActual);
            localStorage.setItem('cuponesUsados', JSON.stringify(usados));
            localStorage.setItem('codigosCanjeados', JSON.stringify(canjeados));
            link.style.display = 'inline-block'; link.href = canvas.toDataURL("image/png");
            link.download = "cupon_zaira.png"; restartBtn.style.display = 'inline-block';
            actualizarEstado();
        }
    </script>
</body>
</html>