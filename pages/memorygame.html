<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory Challenge ‚ú®</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');
        :root { --rosa-fuerte: #fb6f92; --rosa-claro: #ffc8dd; --texto: #8a5a6a; }
        body { background-color: #fff0f5; font-family: 'Quicksand', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding-top: 20px; box-sizing: border-box; }
        .navbar { position: fixed; top: 0; width: 100%; display: flex; justify-content: flex-end; padding: 15px; box-sizing: border-box; z-index: 1000; }
        .dropbtn { background-color: white; color: var(--rosa-fuerte); padding: 10px 20px; font-size: 1rem; font-weight: bold; border: 2px solid var(--rosa-claro); border-radius: 25px; cursor: pointer; }
        .dropdown-content { display: none; position: absolute; right: 15px; top: 60px; background-color: white; min-width: 180px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 2px solid var(--rosa-claro); overflow: hidden; }
        .dropdown-content a { color: var(--texto); padding: 12px; text-decoration: none; display: block; font-weight: 600; cursor: pointer; }
        .show { display: block; }
        .header-container { display: flex; align-items: center; justify-content: center; gap: 20px; margin-top: 40px; margin-bottom: 10px; }
        .snoopy-header { width: 120px; height: auto; }
        .snoopy-decor { width: 100px; height: auto; }
        .game-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 95%; max-width: 400px; }
        .card { aspect-ratio: 1/1; background-color: var(--rosa-fuerte); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; color: transparent; cursor: pointer; transition: 0.3s; border: 3px solid white; }
        .card.flipped { background-color: white; color: initial; transform: rotateY(180deg); border: 3px solid var(--rosa-claro); }
        .card.matched { visibility: hidden; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 30px; z-index: 2000; width: 85%; max-width: 350px; text-align: center; border: 5px solid var(--rosa-claro); box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1500; backdrop-filter: blur(4px); }
        .btn { background: var(--rosa-fuerte); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; margin-top: 15px; width: 100%; font-family: inherit; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="dropdown">
            <button onclick="document.getElementById('myDropdown').classList.toggle('show')" class="dropbtn">‚ò∞ Men√∫</button>
            <div id="myDropdown" class="dropdown-content">
                <a href="../index.html">üè† Inicio</a>
                <a href="jump.html">üèÉ Snoopy Jump</a>
                <a href="quizgame.html">üß† Preguntados</a>
                <a href="djsnoopy.html">üéµ Dj Snoopy</a>
                <a href="codigos.html">üèÜ Mis C√≥digos</a>
                <a onclick="resetTimer()">üîì Reset Tiempo (Admin)</a>
            </div>
        </div>
    </nav>
    <div class="header-container">
        <img src="../assets/images/snoopy_detective.png" alt="Snoopy Index" class="snoopy-header">
    </div>
    <div id="intro-overlay" class="overlay" style="display: block;"></div>
    <div id="intro-modal" class="modal" style="display: block;">
        <h2 style="color: var(--rosa-fuerte)">Desaf√≠o de Memoria ‚ú®</h2>
        <p>Es el t√≠pico juego de encontrar el par de la figura.<br><br>Super√° los 4 niveles.<br>Ten√©s tiempo y movimientos limitados.<br><b>Ojo:</b> Si abandon√°s, perdes o cerr√°s el juego una vez empezado, se bloquear√° por 72 horas.</p>
        <button class="btn" onclick="startGame()">ACEPTO EL DESAF√çO</button>
    </div>
    <div id="game-view">
        <div style="text-align:center">
            <h2 style="color: var(--rosa-fuerte)">Nivel <span id="level-txt">1</span>/4</h2>
            <p>Tiempo: <span id="clock">00</span>s | Movs: <span id="moves">0</span>/<span id="move-limit">0</span></p>
        </div>
        <div class="game-grid" id="grid"></div>
    </div>
    <div id="lockout-screen" class="modal">
        <h2 id="lockout-title">Alto ah√≠, esper√° un cachito ‚è≥</h2>
        <p id="lockout-msg">Ya jugaste hace nada morocha. Vuelve en 72 horas para otro c√≥digo.</p>
        <button class="btn" onclick="location.href='../index.html'">Volver al Inicio</button>
    </div>
    <div class="overlay" id="overlay"></div>
    <div class="modal" id="modal"><h2 id="modal-title"></h2><button class="btn" onclick="nextLevel()">Siguiente Nivel</button></div>
    <div id="win-screen" class="modal">
        <h2 style="color: var(--rosa-fuerte)">EEEEEESAAAAAAA üèÜ</h2>
        <p>Tu c√≥digo aleatorio es:</p>
        <div id="codigo-memory" style="font-size: 1.8rem; font-weight: bold; color: var(--rosa-fuerte); margin: 15px 0; background: #fff0f5; padding: 10px; border-radius: 15px;">---</div>
        <button class="btn" onclick="finishGame()">Finalizar desaf√≠o</button>
    </div>
    <script>
        const CODIGOS_MAESTROS = ["culogordo", "ternerito", "05052025", "bebota", "elefante", "cocodrilo", "mariquita", "01022025", "24032025", "woodstuck", "sanvalentin", "papasfritas", "peonias", "hombreara√±a", "patatuilla", "silenciogil", "chipamboca", "colorincolorao", "gatitoexplota", "pinguinoenojado", "uncodigorandom", "uncodigorandom2", "equisde", "esnupi", "ca1000", "hayquematarlo"];
        const icons = ['üçë', 'üêä', 'üêú', '‚ù§Ô∏è', 'üê¢', 'üê•', 'üåü', 'üçï', 'üç¶', 'üß∏', 'üéÄ', 'üç≠'];
        let level = 1, moves = 0, matchedPairs = 0, flippedCards = [], isLocking = false, timeLeft, timerInterval, currentMoveLimit;
        function checkLockout() { const lw = localStorage.getItem('lastGameWin'); if(lw && Date.now() - lw < 72*60*60*1000) { document.getElementById('intro-modal').style.display = 'none'; document.getElementById('intro-overlay').style.display = 'none'; document.getElementById('game-view').style.display = 'none'; document.getElementById('lockout-screen').style.display = 'block'; return true; } return false; }
        function startGame() { if(localStorage.getItem('memoryInProgress') === 'true') { failCheat("Abandonaste la partida anterior"); return; } document.getElementById('intro-modal').style.display = 'none'; document.getElementById('intro-overlay').style.display = 'none'; localStorage.setItem('memoryInProgress', 'true'); initGame(); }
        function initGame() {
            const grid = document.getElementById('grid'); grid.innerHTML = ''; moves = 0; matchedPairs = 0; flippedCards = []; isLocking = false;
            let pairs = level === 1 ? 4 : (level === 2 ? 6 : (level === 3 ? 9 : 12));
            timeLeft = level === 1 ? 30 : (level === 2 ? 60 : (level === 3 ? 75 : 105));
            currentMoveLimit = level === 1 ? 15 : (level === 2 ? 25 : (level === 3 ? 35 : 45));
            document.getElementById('moves').innerText = moves; document.getElementById('move-limit').innerText = currentMoveLimit; document.getElementById('level-txt').innerText = level;
            const gameIcons = [...icons.slice(0, pairs), ...icons.slice(0, pairs)].sort(() => Math.random() - 0.5);
            grid.style.gridTemplateColumns = pairs > 8 ? 'repeat(4, 1fr)' : 'repeat(3, 1fr)';
            gameIcons.forEach(icon => {
                const card = document.createElement('div'); card.classList.add('card'); card.dataset.icon = icon; card.innerHTML = icon;
                card.onclick = () => {
                    if (isLocking || card.classList.contains('flipped')) return;
                    card.classList.add('flipped'); flippedCards.push(card);
                    if (flippedCards.length === 2) {
                        moves++; document.getElementById('moves').innerText = moves; isLocking = true;
                        if (flippedCards[0].dataset.icon === flippedCards[1].dataset.icon) {
                            setTimeout(() => { flippedCards.forEach(c => c.classList.add('matched')); matchedPairs++; flippedCards = []; isLocking = false; if (matchedPairs === pairs) { clearInterval(timerInterval); checkWin(); } }, 400);
                        } else {
                            setTimeout(() => { flippedCards.forEach(c => c.classList.remove('flipped')); flippedCards = []; isLocking = false; if (moves >= currentMoveLimit) { failCheat("¬°Te quedaste sin movimientos!"); } }, 800);
                        }
                    }
                };
                grid.appendChild(card);
            });
            startTimer();
        }
        function startTimer() { clearInterval(timerInterval); timerInterval = setInterval(() => { timeLeft--; document.getElementById('clock').innerText = timeLeft; if (timeLeft <= 0) { failCheat("¬°Se acab√≥ el tiempo!"); } }, 1000); }
        function failCheat(motivo) { clearInterval(timerInterval); localStorage.setItem('lastGameWin', Date.now().toString()); localStorage.removeItem('memoryInProgress'); document.getElementById('intro-modal').style.display = 'none'; document.getElementById('intro-overlay').style.display = 'none'; document.getElementById('game-view').style.display = 'none'; document.getElementById('lockout-title').innerText = "Muerte S√∫bita ‚ùå"; document.getElementById('lockout-msg').innerText = motivo + ". Ten√©s que esperar 72 horas para volver a intentar."; document.getElementById('lockout-screen').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; }
        function checkWin() {
            if (level < 4) { document.getElementById('modal-title').innerText = `Nivel ${level} OK!`; document.getElementById('modal').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; }
            else {
                localStorage.removeItem('memoryInProgress');
                let conseguidos = JSON.parse(localStorage.getItem('codigosConseguidos')) || [];
                let disponibles = CODIGOS_MAESTROS.filter(c => !conseguidos.includes(c));
                let premio = disponibles.length > 0 ? disponibles[Math.floor(Math.random()*disponibles.length)] : "EXPERT";
                if(disponibles.length > 0) { conseguidos.push(premio); localStorage.setItem('codigosConseguidos', JSON.stringify(conseguidos)); }
                document.getElementById('codigo-memory').innerText = premio.toUpperCase(); document.getElementById('win-screen').style.display = 'block'; document.getElementById('overlay').style.display = 'block';
            }
        }
        function nextLevel() { level++; document.getElementById('modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; initGame(); }
        function finishGame() { localStorage.setItem('lastGameWin', Date.now().toString()); location.href = '../index.html'; }
        function resetTimer() { if(prompt("Pass:") === "ivancito") { localStorage.removeItem('lastGameWin'); localStorage.removeItem('memoryInProgress'); location.reload(); } }
        if(!checkLockout()) { if(localStorage.getItem('memoryInProgress') === 'true') { failCheat("Abandonaste la partida anterior"); } }
        window.onclick = e => { if (!e.target.matches('.dropbtn')) document.getElementById("myDropdown").classList.remove('show'); }
    </script>
</body>
</html>