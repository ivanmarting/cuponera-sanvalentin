<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory Challenge âœ¨</title>
    <link rel="stylesheet" href="../assets/scss/main.css">
</head>
<body class="memory-page">
    <nav class="navbar">
        <div class="dropdown">
            <button onclick="toggleMenu(event)" class="dropbtn">â˜° MenÃº</button>
            <div id="myDropdown" class="dropdown-content">
                <a href="../index.html">ğŸ  Inicio</a>
                <a href="jump.html">ğŸƒ Snoopy Jump</a>
                <a href="quizgame.html">ğŸ§  Preguntados</a>
                <a href="cooking_v2.html">ğŸ‘¨â€ğŸ³ Food Truck</a>
                <a href="djsnoopy.html">ğŸµ Dj Snoopy</a>
                <a href="codigos.html">ğŸ† Mis CÃ³digos</a>
                <a onclick="resetTimerMemory()">ğŸ”“ Reset Tiempo (Admin)</a>
            </div>
        </div>
    </nav>

    <div class="header-container">
        <img src="../assets/images/snoopy_detective.png" alt="Snoopy Detective" class="snoopy-header">
    </div>

    <div id="intro-overlay" class="overlay" style="display: block;"></div>
    <div id="intro-modal" class="modal" style="display: block;">
        <h2 style="color: #fb6f92">DesafÃ­o de Memoria âœ¨</h2>
        <p>Es el tÃ­pico juego de encontrar el par de la figura.<br><br>SuperÃ¡ los 4 niveles.<br>TenÃ©s tiempo y movimientos limitados.<br><b>Ojo:</b> Si abandonÃ¡s, perdes o cerrÃ¡s el juego una vez empezado, se bloquearÃ¡ por 72 horas.</p>
        <button class="btn" onclick="startGame()">ACEPTO EL DESAFÃO</button>
    </div>

    <div id="game-view">
        <div style="text-align:center">
            <h2 style="color: #fb6f92">Nivel <span id="level-txt">1</span>/4</h2>
            <p>Tiempo: <span id="clock">00</span>s | Movs: <span id="moves">0</span>/<span id="move-limit">0</span></p>
        </div>
        <div class="game-grid" id="grid"></div>
    </div>

    <div id="lockout-screen" class="modal">
        <h2 id="lockout-title">Alto ahÃ­, esperÃ¡ un cachito â³</h2>
        <p id="lockout-msg">Ya jugaste hace nada morocha. Vuelve en 72 horas para otro cÃ³digo.</p>
        <button class="btn" onclick="location.href='../index.html'">Volver al Inicio</button>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="modal" id="modal">
        <h2 id="modal-title"></h2>
        <button class="btn" onclick="nextLevel()">Siguiente Nivel</button>
    </div>

    <div id="win-screen" class="modal">
        <h2 style="color: #fb6f92">EEEEEESAAAAAAA ğŸ†</h2>
        <p>Tu cÃ³digo aleatorio es:</p>
        <div id="codigo-memory">---</div>
        <button class="btn" onclick="finishGame()">Finalizar desafÃ­o</button>
    </div>

    <script src="../assets/js/main.js"></script>
    <script>
        // --- LÃ“GICA DEL MOTOR DE JUEGO (Inalterada) ---
        const CODIGOS_MAESTROS = ["culogordo", "ternerito", "05052025", "bebota", "elefante", "cocodrilo", "mariquita", "01022025", "24032025", "woodstuck", "sanvalentin", "papasfritas", "peonias", "hombrearaÃ±a", "patatuilla", "silenciogil", "chipamboca", "colorincolorao", "gatitoexplota", "pinguinoenojado", "uncodigorandom", "uncodigorandom2", "equisde", "esnupi", "ca1000", "hayquematarlo"];
        const icons = ['ğŸ‘', 'ğŸŠ', 'ğŸœ', 'â¤ï¸', 'ğŸ¢', 'ğŸ¥', 'ğŸŒŸ', 'ğŸ•', 'ğŸ¦', 'ğŸ§¸', 'ğŸ€', 'ğŸ­'];
        let level = 1, moves = 0, matchedPairs = 0, flippedCards = [], isLocking = false, timeLeft, timerInterval, currentMoveLimit;

        function checkLockout() { 
            const lw = localStorage.getItem('lastGameWin'); 
            if(lw && Date.now() - lw < 72*60*60*1000) { 
                document.getElementById('intro-modal').style.display = 'none'; 
                document.getElementById('intro-overlay').style.display = 'none'; 
                document.getElementById('game-view').style.display = 'none'; 
                document.getElementById('lockout-screen').style.display = 'block'; 
                return true; 
            } 
            return false; 
        }

        function startGame() { 
            if(localStorage.getItem('memoryInProgress') === 'true') { failCheat("Abandonaste la partida anterior"); return; } 
            document.getElementById('intro-modal').style.display = 'none'; 
            document.getElementById('intro-overlay').style.display = 'none'; 
            localStorage.setItem('memoryInProgress', 'true'); 
            initGame(); 
        }

        function initGame() {
            const grid = document.getElementById('grid'); grid.innerHTML = ''; moves = 0; matchedPairs = 0; flippedCards = []; isLocking = false;
            let pairs = level === 1 ? 4 : (level === 2 ? 6 : (level === 3 ? 9 : 12));
            timeLeft = level === 1 ? 30 : (level === 2 ? 60 : (level === 3 ? 75 : 105));
            currentMoveLimit = level === 1 ? 15 : (level === 2 ? 25 : (level === 3 ? 35 : 45));
            document.getElementById('moves').innerText = moves; document.getElementById('move-limit').innerText = currentMoveLimit; document.getElementById('level-txt').innerText = level;
            const gameIcons = [...icons.slice(0, pairs), ...icons.slice(0, pairs)].sort(() => Math.random() - 0.5);
            grid.style.gridTemplateColumns = pairs > 8 ? 'repeat(4, 1fr)' : 'repeat(3, 1fr)';
            gameIcons.forEach(icon => {
                const card = document.createElement('div'); card.classList.add('card'); card.dataset.icon = icon; card.innerHTML = icon;
                card.onclick = () => {
                    if (isLocking || card.classList.contains('flipped')) return;
                    card.classList.add('flipped'); flippedCards.push(card);
                    if (flippedCards.length === 2) {
                        moves++; document.getElementById('moves').innerText = moves; isLocking = true;
                        if (flippedCards[0].dataset.icon === flippedCards[1].dataset.icon) {
                            setTimeout(() => { flippedCards.forEach(c => c.classList.add('matched')); matchedPairs++; flippedCards = []; isLocking = false; if (matchedPairs === pairs) { clearInterval(timerInterval); checkWin(); } }, 400);
                        } else {
                            setTimeout(() => { flippedCards.forEach(c => c.classList.remove('flipped')); flippedCards = []; isLocking = false; if (moves >= currentMoveLimit) { failCheat("Â¡Te quedaste sin movimientos!"); } }, 800);
                        }
                    }
                };
                grid.appendChild(card);
            });
            startTimer();
        }

        function startTimer() { clearInterval(timerInterval); timerInterval = setInterval(() => { timeLeft--; document.getElementById('clock').innerText = timeLeft; if (timeLeft <= 0) { failCheat("Â¡Se acabÃ³ el tiempo!"); } }, 1000); }
        
        function failCheat(motivo) { 
            clearInterval(timerInterval); 
            localStorage.setItem('lastGameWin', Date.now().toString()); 
            localStorage.removeItem('memoryInProgress'); 
            document.getElementById('intro-modal').style.display = 'none'; 
            document.getElementById('intro-overlay').style.display = 'none'; 
            document.getElementById('game-view').style.display = 'none'; 
            document.getElementById('lockout-title').innerText = "Muerte SÃºbita âŒ"; 
            document.getElementById('lockout-msg').innerText = motivo + ". TenÃ©s que esperar 72 horas para volver a intentar."; 
            document.getElementById('lockout-screen').style.display = 'block'; 
            document.getElementById('overlay').style.display = 'block'; 
        }

        function checkWin() {
            if (level < 4) { document.getElementById('modal-title').innerText = `Nivel ${level} OK!`; document.getElementById('modal').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; }
            else {
                localStorage.removeItem('memoryInProgress');
                let conseguidos = JSON.parse(localStorage.getItem('codigosConseguidos')) || [];
                let disponibles = CODIGOS_MAESTROS.filter(c => !conseguidos.includes(c));
                let premio = disponibles.length > 0 ? disponibles[Math.floor(Math.random()*disponibles.length)] : "EXPERT";
                if(disponibles.length > 0) { conseguidos.push(premio); localStorage.setItem('codigosConseguidos', JSON.stringify(conseguidos)); }
                document.getElementById('codigo-memory').innerText = premio.toUpperCase(); 
                document.getElementById('win-screen').style.display = 'block'; 
                document.getElementById('overlay').style.display = 'block';
            }
        }

        function nextLevel() { level++; document.getElementById('modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; initGame(); }
        function finishGame() { localStorage.setItem('lastGameWin', Date.now().toString()); location.href = '../index.html'; }
        
        if(!checkLockout()) { if(localStorage.getItem('memoryInProgress') === 'true') { failCheat("Abandonaste la partida anterior"); } }
    </script>
</body>
</html>